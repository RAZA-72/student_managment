{{> header }}
{{> sidebar }}

<main id="main" class="main">
  <div class="container mt-4" style="padding: 0 20px;">
    <h2 class="mb-4" style="margin-bottom: 1.5rem; font-size: 1.875rem; font-weight: 700; color: #1f2937; display: flex; align-items: center;">
      <span style="margin-right: 10px;">ðŸ“Š</span> Admin Dashboard
    </h2>

    <!-- Statistics Cards -->
    <div style="display: grid; grid-template-columns: repeat(1, 1fr); gap: 1rem; margin-bottom: 1.5rem;">
      <!-- Responsive grid for larger screens -->
      <style>
        @media (min-width: 768px) {
          .stats-grid { grid-template-columns: repeat(4, 1fr); }
        }
      </style>
      <div class="stats-grid" style="display: grid; grid-template-columns: repeat(1, 1fr); gap: 1rem; margin-bottom: 1.5rem;">
        <!-- Total Students Card -->
        <div style="background-color: white; padding: 1.5rem; border-radius: 0.75rem; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); border-left: 4px solid #3b82f6;">
          <div style="display: flex; align-items: center;">
            <div style="background-color: #dbeafe; padding: 0.75rem; border-radius: 0.5rem;">
              <i class="bi bi-people" style="color: #2563eb; font-size: 1.5rem;"></i>
            </div>
            <div style="margin-left: 1rem;">
              <h3 style="font-size: 1.5rem; font-weight: 700; color: #1f2937;">{{totalStudents}}</h3>
              <p style="color: #6b7280;">Total Students</p>
            </div>
          </div>
        </div>

        <!-- Average Performance Card -->
        {{#if performanceStats}}
        <div style="background-color: white; padding: 1.5rem; border-radius: 0.75rem; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); border-left: 4px solid #10b981;">
          <div style="display: flex; align-items: center;">
            <div style="background-color: #d1fae5; padding: 0.75rem; border-radius: 0.5rem;">
              <i class="bi bi-graph-up" style="color: #059669; font-size: 1.5rem;"></i>
            </div>
            <div style="margin-left: 1rem;">
              <h3 style="font-size: 1.5rem; font-weight: 700; color: #1f2937;">
                {{#if performanceStats.avg_total_score}}
                  {{round performanceStats.avg_total_score 2}}
                {{else}}
                  0
                {{/if}}
              </h3>
              <p style="color: #6b7280;">Avg Score</p>
            </div>
          </div>
        </div>
        {{/if}}

        <!-- Top Score Card -->
        {{#if performanceStats}}
        <div style="background-color: white; padding: 1.5rem; border-radius: 0.75rem; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); border-left: 4px solid #8b5cf6;">
          <div style="display: flex; align-items: center;">
            <div style="background-color: #ede9fe; padding: 0.75rem; border-radius: 0.5rem;">
              <i class="bi bi-trophy" style="color: #7c3aed; font-size: 1.5rem;"></i>
            </div>
            <div style="margin-left: 1rem;">
              <h3 style="font-size: 1.5rem; font-weight: 700; color: #1f2937;">
                {{#if performanceStats.max_total_score}}
                  {{performanceStats.max_total_score}}
                {{else}}
                  0
                {{/if}}
              </h3>
              <p style="color: #6b7280;">Top Score</p>
            </div>
          </div>
        </div>
        {{/if}}

        <!-- Total Records Card -->
        {{#if performanceStats}}
        <div style="background-color: white; padding: 1.5rem; border-radius: 0.75rem; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); border-left: 4px solid #f59e0b;">
          <div style="display: flex; align-items: center;">
            <div style="background-color: #fef3c7; padding: 0.75rem; border-radius: 0.5rem;">
              <i class="bi bi-clipboard-data" style="color: #d97706; font-size: 1.5rem;"></i>
            </div>
            <div style="margin-left: 1rem;">
              <h3 style="font-size: 1.5rem; font-weight: 700; color: #1f2937;">
                {{performanceStats.total_records}}
              </h3>
              <p style="color: #6b7280;">Performance Records</p>
            </div>
          </div>
        </div>
        {{/if}}
      </div>
    </div>

    <div style="display: grid; grid-template-columns: repeat(1, 1fr); gap: 1.5rem; margin-bottom: 1.5rem;">
      <style>
        @media (min-width: 1024px) {
          .main-grid { grid-template-columns: repeat(2, 1fr); }
        }
      </style>
      <div class="main-grid" style="display: grid; grid-template-columns: repeat(1, 1fr); gap: 1.5rem; margin-bottom: 1.5rem;">
        <!-- Top Students Section -->
        <div style="background-color: white; padding: 1.5rem; border-radius: 0.75rem; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);">
          <h3 style="font-size: 1.25rem; font-weight: 700; margin-bottom: 1rem; display: flex; align-items: center;">
            <i class="bi bi-trophy-fill" style="color: #f59e0b; margin-right: 0.5rem;"></i>
            Top Performing Students
          </h3>
          {{#if topStudents.length}}
          <div style="display: flex; flex-direction: column; gap: 0.75rem;">
            {{#each topStudents}}
            <div style="display: flex; align-items: center; justify-content: space-between; padding: 0.75rem; background-color: #f9fafb; border-radius: 0.5rem; transition: all 0.2s;">
              <div style="display: flex; align-items: center;">
                <div style="width: 2rem; height: 2rem; background-color: #3b82f6; color: white; border-radius: 9999px; display: flex; align-items: center; justify-content: center; font-size: 0.875rem; font-weight: 700;">
                  {{add @index 1}}
                </div>
                <div style="margin-left: 0.75rem;">
                  <h4 style="font-weight: 600;">{{this.Student.name}}</h4>
                  <p style="font-size: 0.875rem; color: #6b7280;">{{this.Student.course}} â€¢ {{this.semester}}</p>
                </div>
              </div>
              <div style="text-align: right;">
                <span style="font-weight: 700; font-size: 1.125rem;">{{this.total_score}}</span>
                <span style="display: block; font-size: 0.875rem; color: #059669;">{{this.grade}} ({{this.percentage}}%)</span>
              </div>
            </div>
            {{/each}}
          </div>
          {{else}}
          <div style="text-align: center; padding: 2rem 0; color: #6b7280;">
            <i class="bi bi-info-circle" style="font-size: 1.875rem; margin-bottom: 0.5rem;"></i>
            <p>No performance records found</p>
          </div>
          {{/if}}
        </div>

        <!-- Quick Actions -->
        <div style="background-color: white; padding: 1.5rem; border-radius: 0.75rem; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);">
          <h3 style="font-size: 1.25rem; font-weight: 700; margin-bottom: 1rem;">Quick Actions</h3>
          <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem;">
            <a href="/studentadd" style="display: block; background-color: #dbeafe; padding: 1.5rem; border-radius: 0.75rem; transition: all 0.2s; text-align: center; text-decoration: none; color: inherit;">
              <i class="bi bi-person-plus" style="font-size: 1.5rem; color: #2563eb;"></i>
              <h5 style="margin-top: 0.5rem; font-weight: 600;">Add Student</h5>
            </a>

            <a href="/studentlist" style="display: block; background-color: #d1fae5; padding: 1.5rem; border-radius: 0.75rem; transition: all 0.2s; text-align: center; text-decoration: none; color: inherit;">
              <i class="bi bi-people" style="font-size: 1.5rem; color: #059669;"></i>
              <h5 style="margin-top: 0.5rem; font-weight: 600;">View Students</h5>
            </a>

            <a href="/performanceadd" style="display: block; background-color: #ede9fe; padding: 1.5rem; border-radius: 0.75rem; transition: all 0.2s; text-align: center; text-decoration: none; color: inherit;">
              <i class="bi bi-graph-up-arrow" style="font-size: 1.5rem; color: #7c3aed;"></i>
              <h5 style="margin-top: 0.5rem; font-weight: 600;">Add Performance</h5>
            </a>

            <a href="/performancelist" style="display: block; background-color: #fef3c7; padding: 1.5rem; border-radius: 0.75rem; transition: all 0.2s; text-align: center; text-decoration: none; color: inherit;">
              <i class="bi bi-bar-chart" style="font-size: 1.5rem; color: #d97706;"></i>
              <h5 style="margin-top: 0.5rem; font-weight: 600;">View Performance</h5>
            </a>
          </div>
        </div>
      </div>
    </div>

    <!-- Grade Distribution & Category Stats -->
    {{#if gradeDistribution.length}}
    <div style="display: grid; grid-template-columns: repeat(1, 1fr); gap: 1.5rem;">
      <style>
        @media (min-width: 1024px) {
          .bottom-grid { grid-template-columns: repeat(2, 1fr); }
        }
      </style>
      <div class="bottom-grid" style="display: grid; grid-template-columns: repeat(1, 1fr); gap: 1.5rem;">
        <!-- Grade Distribution -->
        <div style="background-color: white; padding: 1.5rem; border-radius: 0.75rem; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);">
          <h3 style="font-size: 1.25rem; font-weight: 700; margin-bottom: 1rem;">Grade Distribution</h3>
          <div style="display: flex; flex-direction: column; gap: 0.5rem;">
            {{#each gradeDistribution}}
            <div style="display: flex; align-items: center; justify-content: space-between;">
              <span style="font-weight: 500;">{{this.grade}}</span>
              <div style="display: flex; align-items: center;">
                <div style="width: 8rem; background-color: #e5e7eb; border-radius: 9999px; height: 0.5rem; margin-right: 0.75rem;">
                  <div style="background-color: #3b82f6; height: 0.5rem; border-radius: 9999px; width: {{divide this.count ../performanceStats.total_records 100}}%;"></div>
                </div>
                <span style="font-size: 0.875rem; color: #6b7280;">{{this.count}} students</span>
              </div>
            </div>
            {{/each}}
          </div>
        </div>

        <!-- Category Statistics -->
        {{#if categoryStats.length}}
        <div style="background-color: white; padding: 1.5rem; border-radius: 0.75rem; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);">
          <h3 style="font-size: 1.25rem; font-weight: 700; margin-bottom: 1rem;">Performance by Category</h3>
          <div style="display: flex; flex-direction: column; gap: 0.75rem;">
            {{#each categoryStats}}
            <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.5rem; transition: all 0.2s; border-radius: 0.25rem;">
              <span style="text-transform: capitalize;">{{this.category}}</span>
              <div style="text-align: right;">
                <span style="font-weight: 600;">{{round this.avg_score 1}}</span>
                <span style="font-size: 0.875rem; color: #6b7280; margin-left: 0.5rem;">({{this.count}} records)</span>
              </div>
            </div>
            {{/each}}
          </div>
        </div>
        {{/if}}
      </div>
    </div>
    {{/if}}
  </div>
</main>

{{> footer }}